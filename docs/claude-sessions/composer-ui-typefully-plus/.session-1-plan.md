# Session 1 Implementation Plan: Benchmark & Charter

## Objective

Audit the current composer, benchmark Typefully's best-in-class interaction patterns, define a thread-first interaction model, and produce four roadmap documents that lock the design direction and implementation slices for sessions 2–5.

**This session produces documentation only — no source code changes.**

---

## Current State Assessment

### Files Audited

| File | Lines | Role |
|------|-------|------|
| `dashboard/src/lib/components/ComposeModal.svelte` | 455 | Orchestrator: state, autosave, AI, submit |
| `dashboard/src/lib/components/ThreadComposer.svelte` | 427 | Thread card editor, drag-and-drop, CRUD |
| `dashboard/src/lib/components/MediaSlot.svelte` | 294 | Per-card media upload & attachment |
| `dashboard/src/lib/components/composer/ComposerShell.svelte` | 516 | Modal chrome: header, tabs, footer, focus mode |
| `dashboard/src/lib/components/composer/TweetEditor.svelte` | 328 | Single-tweet textarea + media |
| `dashboard/src/lib/components/composer/ThreadPreviewRail.svelte` | 90 | Side-by-side preview pane |
| `dashboard/src/lib/components/composer/VoiceContextPanel.svelte` | 284 | Voice/tone collapsible |
| `dashboard/src/lib/components/composer/ThreadCardActions.svelte` | 125 | Per-card inline action buttons |
| `dashboard/src/lib/components/CommandPalette.svelte` | 342 | Cmd+K action palette |
| `dashboard/src/lib/components/FromNotesPanel.svelte` | 313 | Notes → content AI panel |
| `dashboard/src/lib/components/TweetPreview.svelte` | 138 | Single tweet X-style preview |
| `dashboard/src/lib/components/TimePicker.svelte` | 179 | Schedule time selector |
| `dashboard/src/app.css` | 98 | Design tokens (dark/light) |

### Identified Friction Points

1. **Modal-as-dashboard feel**: The ComposerShell renders as a traditional modal with header/tabs/footer chrome. At 520px (tweet) / 900px (thread), it feels like a dashboard popup rather than a writing surface. The header ("Compose" + date), mode tabs, and footer buttons all compete for visual weight.

2. **Tweet vs. Thread mode bifurcation**: The mode-tabs create a mental split — "am I writing a tweet or a thread?" — before the user has content. Typefully solves this by treating everything as continuous writing that _becomes_ a thread when you add separators.

3. **Side-by-side layout wastes space in tweet mode**: The 50/50 grid (`compose-layout`) gives half the modal to a preview pane that in tweet mode shows a single card. The preview adds value for threads but steals focus from writing in tweet mode.

4. **Thread cards feel like form fields, not flowing content**: Each `tweet-card` in ThreadComposer is a bordered rectangle with its own textarea, gutter number, drag handle, char counter, and action row. This stacks up visual noise fast — a 5-tweet thread shows 5 separate bordered boxes with 5 char counters and 5 action rows.

5. **Voice context panel always visible above editor**: The collapsible VoiceContextPanel sits between the header and the writing area, adding a full row of chrome even when collapsed. It's important but shouldn't gate writing flow.

6. **Footer is heavyweight**: AI Assist, Notes, spacer, Cancel, Submit — the footer has 5 elements including two CTA-styled buttons. The primary action (Submit) competes with the AI actions.

7. **Scheduling buried inside body**: TimePicker is inside the modal body below the editor, after scroll. It should be accessible without scrolling past the writing area.

8. **No continuous-flow editing**: Thread editing is card-by-card (click textarea in card N, type, stop, click textarea in card N+1). There's no "Enter to continue to next tweet" flow or auto-split.

9. **Preview disconnected from editing context**: ThreadPreviewRail shows a separate scrollable column that doesn't scroll-sync with the editor. When editing tweet 8, the preview might still show tweet 1.

---

## Typefully Benchmark Analysis

### Core Patterns to Emulate

| Pattern | Typefully Implementation | Current Tuitbot Gap |
|---------|--------------------------|---------------------|
| **Unibody editor** | Single continuous document; tweet breaks are visual separators (double-newline) not separate form fields | Card-per-tweet with independent textareas |
| **High-fidelity inline preview** | Toggle between "writing mode" and "HiFi preview" in the same pane — no side-by-side split | Always side-by-side; preview is a separate column |
| **Focus mode** | Full-screen, zero-chrome writing; only text visible | Exists but still shows header/tabs/footer in fullscreen |
| **Tweet separator as affordance** | Visual line with character count badge; clicking between separators creates a new tweet | Must explicitly click "Add tweet" button |
| **Auto-split** | Paste long text → automatically splits at word boundaries respecting char limit | No auto-split; must manually add cards |
| **Keyboard-first flow** | Cmd+Enter to add separator, Cmd+Shift+E to toggle preview, arrow keys to navigate between tweets | Good shortcut coverage but different model (card-based) |
| **Low-noise controls** | Secondary actions (schedule, AI, etc.) in a minimal sidebar or contextual toolbar | Footer + collapsible panels competing with writing area |
| **Draft-first philosophy** | Writing surface looks like a note-taking app, not a social media dashboard | Modal with dashboard-style header/tabs |

### Patterns to Exceed (Where We Can Be Better)

1. **Thread-to-tweet fluidity**: Typefully requires switching mental models between single posts and threads. We can make a single tweet simply be "a thread of one" — same editor, same flow.
2. **AI integration depth**: Typefully has basic AI. Our voice context, inline assist, from-notes generation, and per-selection improvement are stronger — we just need to surface them more cleanly.
3. **Real-time preview**: Instead of toggling between modes, we can offer a subtle inline preview below the separator that updates live as you type — no separate column needed.
4. **Command palette breadth**: Our Cmd+K palette with thread actions (split, merge, duplicate, move) is more powerful than Typefully's shortcuts. We should make it even more discoverable.

---

## Proposed Interaction Model: Thread-First Unibody

### Core Concept

Replace the card-per-tweet model with a **continuous writing canvas** where tweet boundaries are **visual separators** rather than separate form controls. A single tweet is simply a thread with one segment.

### Key Interactions

1. **Start writing** — A clean, borderless textarea. No mode tabs visible.
2. **Add a tweet break** — Press `Cmd+Enter` or type a double newline → a visual separator appears. The separator shows the character count for the segment above it.
3. **Remove a tweet break** — Backspace at the start of a segment → merges with previous. Or click the separator's "×" icon.
4. **Reorder tweets** — Drag the separator handle, or use `Alt+Arrow` keys. The separator is the drag target, not the text block.
5. **Auto-split** — Paste text longer than 280 chars → offer inline prompt "Split into thread?" → auto-splits at sentence boundaries.
6. **Preview** — Toggle button switches the canvas between "edit" and "preview" mode inline (not side-by-side). In preview mode, text renders as X-style cards with avatar/handle/thread connector.
7. **Focus mode** — Strips all chrome: no header, no footer. Only the canvas + a small floating submit button in the bottom-right.
8. **Secondary controls** — Schedule, AI, voice, and media live in a collapsible **inspector rail** on the right that can be toggled with a button or `Cmd+I`. Hidden by default on mobile.

### Migration Strategy

The unibody model is a substantial departure from the current card-based ThreadComposer. To minimize risk:

- **Session 2** changes only the shell/layout (header, footer, chrome reduction). The ThreadComposer still works as-is inside the new shell.
- **Session 3** introduces the unibody editor for threads _alongside_ the existing card editor (feature flag or component swap). The data model (`ThreadBlock[]`) stays the same — the unibody editor just synthesizes/parses blocks from a continuous text with separators.
- **Session 4** refines secondary controls into the inspector rail.
- **Session 5** validates and releases.

This means the ThreadBlock API contract doesn't change. The unibody editor internally manages a single text string but emits `ThreadBlock[]` to the parent — preserving the existing submission flow.

---

## Implementation Slices

### Session 2: Composer Shell Redesign

**Goal**: Rebuild the modal chrome into a calmer writing surface.

**Scope**:
- Replace `ComposerShell.svelte` with cleaner structure:
  - New `ComposerHeaderBar.svelte`: Minimal — close button, inline preview toggle, focus-mode toggle. No "Compose" title. Date shown only when scheduling is active.
  - Remove mode tabs from header. Mode switching moves to the command palette and keyboard shortcuts only (users shouldn't need to pre-decide tweet vs thread).
  - New `ComposerCanvas.svelte`: Wrapper that provides the writing area layout with optional inspector rail.
- Move footer actions: Submit becomes a floating button inside the canvas. AI actions move to command palette / inspector.
- Adjust modal sizing: Default wider (640px), thread mode stretches to full-width available.
- Preserve all existing open/close, autosave, submit, and keyboard shortcut behavior.

**Files to create**:
- `dashboard/src/lib/components/composer/ComposerHeaderBar.svelte`
- `dashboard/src/lib/components/composer/ComposerCanvas.svelte`

**Files to modify**:
- `dashboard/src/lib/components/composer/ComposerShell.svelte`
- `dashboard/src/lib/components/ComposeModal.svelte`

**Risk**: Breaking existing compose workflows. **Mitigation**: Keep ComposeModal's state management and submission logic untouched; only change presentation layer.

---

### Session 3: Thread Interactions & Media

**Goal**: Replace card-per-tweet editing with connected flow editing.

**Scope**:
- New `ThreadFlowEditor.svelte`: Continuous textarea with visual tweet separators. Internally tracks cursor position relative to block boundaries.
- New `ThreadSeparator.svelte`: Visual divider showing char count, drag handle, and merge/split affordances on hover.
- Auto-split on paste: Detect pasted text exceeding 280 chars → prompt → split at sentence boundaries.
- `Cmd+Enter` inserts separator at cursor position.
- Backspace at separator boundary merges blocks.
- Drag separators to reorder.
- Inline media attachment per-segment (media appears below the segment text, above the separator).
- Preserve `ThreadBlock[]` emission for parent compatibility.

**Files to create**:
- `dashboard/src/lib/components/composer/ThreadFlowEditor.svelte`
- `dashboard/src/lib/components/composer/ThreadSeparator.svelte`

**Files to modify**:
- `dashboard/src/lib/components/ThreadComposer.svelte` (may become a thin wrapper or be replaced)
- `dashboard/src/lib/components/ComposeModal.svelte` (swap ThreadComposer → ThreadFlowEditor)

**Risk**: Complex cursor/selection management in a single textarea that represents multiple logical blocks. **Mitigation**: Use contenteditable div with block-level children rather than a single textarea, allowing DOM-level separation while keeping visual continuity. If contenteditable proves fragile, fall back to stacked textareas with visual connectors (connected flow _appearance_ without true unibody).

---

### Session 4: Inspector Actions & Polish

**Goal**: Move secondary controls out of the main canvas into a contextual inspector.

**Scope**:
- New `ComposerInspector.svelte`: Right-side collapsible rail containing:
  - Schedule/time picker
  - Voice context panel
  - From-notes panel
  - Preview toggle (inline vs. inspector preview)
- Toggle via `Cmd+I` or toolbar button.
- Auto-collapse on mobile (<768px); accessible via bottom sheet or drawer.
- Refine command palette to include inspector toggle.
- Add lightweight onboarding hints (keyboard shortcut badges on first use).
- Update `docs/composer-mode.md` to reflect new UI.

**Files to create**:
- `dashboard/src/lib/components/composer/ComposerInspector.svelte`

**Files to modify**:
- `dashboard/src/lib/components/ComposeModal.svelte`
- `dashboard/src/lib/components/composer/ComposerCanvas.svelte`
- `dashboard/src/lib/components/composer/VoiceContextPanel.svelte`
- `dashboard/src/lib/components/FromNotesPanel.svelte`
- `dashboard/src/lib/components/CommandPalette.svelte`

**Risk**: Inspector adds complexity to responsive layout. **Mitigation**: Start with a simple slide-in panel that overlays the canvas on mobile rather than attempting a true responsive grid.

---

### Session 5: Validation & Release

**Goal**: End-to-end validation, regression fixes, release decision.

**Scope**:
- Run full CI suite (fmt, clippy, tests, svelte-check, build).
- Manual audit of all compose flows: open from calendar, draft tweet, draft thread, reorder, attach media, AI assist, schedule, autosave recovery, close.
- Confirm charter compliance.
- Write go/no-go release report.
- Document known limitations and follow-up work.

**Files to create**:
- `docs/roadmap/composer-ui-typefully-plus/release-readiness.md`

**No source changes unless fixing regressions.**

---

## Session 1 Deliverables (This Session)

### Files to Create

All under `docs/roadmap/composer-ui-typefully-plus/`:

1. **`charter.md`** — Product charter: positioning, principles, success criteria, non-goals.
2. **`benchmark-notes.md`** — Typefully analysis, patterns to emulate, patterns to exceed.
3. **`ui-architecture.md`** — Component hierarchy, data flow, interaction model, new component specs.
4. **`session-01-handoff.md`** — Decisions made, scope locked, inputs needed for Session 2.

### Content Outline for Each Document

#### charter.md
- Problem statement (current composer friction)
- Vision (thread-first unibody writing surface)
- Design principles (writing first, progressive disclosure, keyboard-native, mobile-ready)
- Success criteria (measurable: fewer clicks to create thread, reduced visible chrome, same feature coverage)
- Non-goals (no new backend APIs, no new content types, no analytics changes)
- Session roadmap summary

#### benchmark-notes.md
- Typefully's core UX model (unibody, separator-based, draft-first)
- Feature-by-feature comparison table
- Patterns to emulate (with rationale)
- Patterns to exceed (with rationale)
- Patterns to skip (with rationale — e.g., auto-numbering, blog unrolling)

#### ui-architecture.md
- Component hierarchy diagram (text-based)
- Data flow: ComposeModal → ComposerCanvas → ThreadFlowEditor → ThreadBlock[]
- New component specs (ComposerHeaderBar, ComposerCanvas, ComposerInspector, ThreadFlowEditor, ThreadSeparator)
- Interaction state machine (idle → writing → thread-mode → preview → submit)
- CSS/token strategy (which new tokens, if any)
- Responsive breakpoints and behavior

#### session-01-handoff.md
- Decisions made in this session
- Scope locked for Session 2
- Required inputs for Session 2
- Open questions for future sessions
- Risk register

---

## Key Design Decisions

1. **No mode tabs**: Tweet vs. thread is determined by content, not by a toggle. A single-segment draft is a tweet; adding a separator makes it a thread. This eliminates the mode decision before writing.

2. **Unibody editor with separator affordances**: Instead of card-per-tweet, use a continuous writing surface with visual separators. The separator is the primary interaction target for thread operations (reorder, merge, split).

3. **Inline preview over side-by-side**: Replace the 50/50 grid with a toggle between edit and preview in the same pane. This gives the full width to writing when editing and full width to preview when reviewing.

4. **Inspector rail for secondary controls**: Schedule, voice, notes, and preview move to a collapsible right rail. This keeps the writing canvas clean while making power features accessible via Cmd+I.

5. **ThreadBlock[] contract preserved**: The internal representation of thread content doesn't change. The unibody editor synthesizes blocks from text+separators and emits the same `ThreadBlock[]` to the parent on every change.

6. **Incremental migration**: Each session changes one layer (shell → editor → inspector → validation) so regressions are isolated and recoverable.

---

## Risks and Mitigations

| Risk | Severity | Mitigation |
|------|----------|------------|
| Unibody editor cursor management complexity | High | Use contenteditable with block children rather than single textarea. Fall back to connected card UI if contenteditable is too fragile. |
| Breaking existing autosave format | Medium | Keep the same localStorage format (`ThreadBlock[]`). Unibody editor parses blocks on load and emits blocks on change. |
| Mobile responsive regression | Medium | Test mobile breakpoints (640px, 768px) in each session. Keep inspector as overlay/drawer on mobile. |
| Scope creep across sessions | Medium | Each session has explicit scope and handoff. If a session discovers extra work, document it as a scope cut and move to next session. |
| ComposerShell.svelte exceeds 500-line limit after changes | Low | Session 2 explicitly decomposes it into HeaderBar + Canvas subcomponents. |
| Preview mode UX degradation | Low | Inline preview reuses existing TweetPreview component, just renders it in-place instead of in a side column. |

---

## Verification Steps

### Quality Gates (run after writing all docs)
```bash
# Rust CI (no Rust changes expected, but verify nothing is broken)
cargo fmt --all && cargo fmt --all --check
RUSTFLAGS="-D warnings" cargo test --workspace
cargo clippy --workspace -- -D warnings

# Frontend CI (no frontend changes expected, but verify)
cd dashboard && npm run check
```

### Manual Verification
- All four deliverable files exist under `docs/roadmap/composer-ui-typefully-plus/`
- Charter describes a differentiated direction
- Session boundaries in handoff are specific enough to execute without re-planning
- No source code files were modified

---

## Exact Order of Operations

1. Create `docs/roadmap/composer-ui-typefully-plus/` directory (if not exists)
2. Write `docs/roadmap/composer-ui-typefully-plus/benchmark-notes.md`
3. Write `docs/roadmap/composer-ui-typefully-plus/charter.md`
4. Write `docs/roadmap/composer-ui-typefully-plus/ui-architecture.md`
5. Write `docs/roadmap/composer-ui-typefully-plus/session-01-handoff.md`
6. Run quality gates:
   - `cargo fmt --all && cargo fmt --all --check`
   - `RUSTFLAGS="-D warnings" cargo test --workspace`
   - `cargo clippy --workspace -- -D warnings`
   - `cd dashboard && npm run check`
7. Verify all four files exist and are well-formed
8. Session complete
