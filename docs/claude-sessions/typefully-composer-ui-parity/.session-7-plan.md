# Session 07 Implementation Plan — Docs & Adoption Readiness

**Date:** 2026-02-27
**Session:** 07
**Goal:** Update documentation to accurately reflect the shipped composer UX, create keyboard shortcut cheatsheet, add migration notes, add troubleshooting guidance, and verify all endpoint references match actual server routes.

---

## Context Summary

Sessions 01–06 are complete. All UI implementation work is done and passing quality gates (`npm run check`, `npm run build`). No Rust or Svelte code changes are required for this session — only documentation files are created or modified.

### Key Implementation Facts (Verified from Source)

**Keyboard shortcuts** — 14 shortcuts registered in `dashboard/src/lib/utils/shortcuts.ts:103-118` (`SHORTCUT_CATALOG`):

| Combo | Label | Category | When |
|-------|-------|----------|------|
| `cmd+enter` | Submit / Post | Compose | always |
| `cmd+shift+f` | Toggle focus mode | Mode | always |
| `cmd+k` | Open command palette | Mode | always |
| `cmd+j` | AI improve selection | AI | always |
| `escape` | Close modal / palette | Mode | always |
| `cmd+shift+n` | Switch to tweet mode | Mode | always |
| `cmd+shift+t` | Switch to thread mode | Mode | always |
| `alt+arrowup` | Move card up | Thread | thread |
| `alt+arrowdown` | Move card down | Thread | thread |
| `cmd+d` | Duplicate card | Thread | thread |
| `cmd+shift+s` | Split at cursor | Thread | thread |
| `cmd+shift+m` | Merge with next | Thread | thread |
| `tab` | Next card | Thread | thread |
| `shift+tab` | Previous card | Thread | thread |

**Command palette actions** — 13 actions in `CommandPalette.svelte:41-55`:
- Mode: Toggle focus mode, Switch to Tweet, Switch to Thread
- Compose: Submit / Post now, Attach media
- AI: AI Improve, Generate from notes
- Thread: Add tweet card, Duplicate card, Split at cursor, Merge with next, Move card up, Move card down

**Actual server routes** (verified from `crates/tuitbot-server/src/lib.rs`):
- Compose: `POST /api/content/compose`
- Drafts: `GET/POST /api/content/drafts`, `PATCH/DELETE /api/content/drafts/{id}`, `POST /api/content/drafts/{id}/publish`, `POST /api/content/drafts/{id}/schedule`
- Assist: `POST /api/assist/tweet`, `POST /api/assist/reply`, `POST /api/assist/thread`, `POST /api/assist/improve`, `GET /api/assist/topics`, `GET /api/assist/optimal-times`, `GET /api/assist/mode`
- Discovery: `GET /api/discovery/feed`, `POST /api/discovery/{tweet_id}/compose-reply`, `POST /api/discovery/{tweet_id}/queue-reply`
- Media: `POST /api/media/upload`, `GET /api/media/file`

**Critical doc accuracy issue found:** `docs/composer-mode.md` currently lists draft endpoints as `/api/drafts/*` but the actual routes are `/api/content/drafts/*`. This must be corrected.

**Critical doc accuracy issue found:** `docs/composer-mode.md` currently lists discovery reply endpoint as `POST /api/discovery/feed/{tweet_id}/reply` but the actual routes are `POST /api/discovery/{tweet_id}/compose-reply` and `POST /api/discovery/{tweet_id}/queue-reply`. The discovery feed stats endpoint (`/api/discovery/feed/stats`) documented in composer-mode.md does not exist in the server routes. This must be corrected.

**Data model** — `ThreadBlock` type (verified from `dashboard/src/lib/api.ts:191-196`):
```typescript
interface ThreadBlock {
  id: string;      // UUID
  text: string;
  media_paths: string[];
  order: number;
}
```

**Auto-save** — namespace `tuitbot:compose:draft`, debounce 500ms, TTL 7 days (verified from `ComposeModal.svelte:83-86`).

**Media constraints** — max 4 images (5MB each) OR 1 GIF (15MB) or 1 video (512MB) per tweet (verified from `ComposeModal.svelte:68-70`).

---

## Deliverables

| # | File | Action | Purpose |
|---|------|--------|---------|
| 1 | `docs/composer-mode.md` | Modify | Rewrite to reflect shipped UI (thread composer, preview, shortcuts, focus mode, command palette, auto-save, per-tweet media). Fix endpoint accuracy issues. |
| 2 | `docs/roadmap/typefully-composer-ui-parity/shortcut-cheatsheet.md` | Create | Complete keyboard shortcut reference organized by category |
| 3 | `docs/roadmap/typefully-composer-ui-parity/session-07-doc-updates.md` | Create | Technical notes on what documentation changed and why |
| 4 | `docs/roadmap/typefully-composer-ui-parity/session-07-handoff.md` | Create | Handoff for Session 08 (final validation) |

Files explicitly NOT modified:
- `README.md` — Already mentions Composer Mode with sufficient overview. The README links to `docs/composer-mode.md` for details (line 286). No changes needed.
- `dashboard/README.md` — Stock SvelteKit README. Not relevant to composer docs.
- `docs/architecture.md` — Already accurately describes three-layer model, runtime loops, AI assist endpoints, and draft lifecycle. No thread-specific data model details needed here (those belong in `composer-mode.md`).

---

## Implementation Plan

### Step 1: Create `shortcut-cheatsheet.md`

**Path:** `docs/roadmap/typefully-composer-ui-parity/shortcut-cheatsheet.md`

**Rationale:** Self-contained reference that `composer-mode.md` links to. Separating the cheatsheet avoids bloating the main workflow doc.

**Content structure:**

```
# Keyboard Shortcut Cheatsheet

## How Shortcuts Work
- Mac: Cmd mapped to ⌘, Alt to ⌥, Shift to ⇧
- Windows/Linux: Cmd mapped to Ctrl
- Shortcuts active only when compose modal is open
- Thread-specific shortcuts only active in thread mode

## Compose (Always Available)
Table: Action | Mac | Windows/Linux | Description
- Submit / Post: ⌘↩ | Ctrl+Enter | Submit or schedule the current content
- Open command palette: ⌘K | Ctrl+K | Search and execute any compose action
- Toggle focus mode: ⌘⇧F | Ctrl+Shift+F | Full-viewport distraction-free editing
- AI improve: ⌘J | Ctrl+J | Improve selected text (or full tweet if no selection)
- Switch to tweet: ⌘⇧N | Ctrl+Shift+N | Switch compose mode to single tweet
- Switch to thread: ⌘⇧T | Ctrl+Shift+T | Switch compose mode to thread
- Close: Esc | Esc | Close modal or palette (exits focus mode first if active)

## Thread Operations (Thread Mode Only)
Table: Action | Mac | Windows/Linux | Description
- Move card up: ⌥↑ | Alt+↑ | Move focused card one position up
- Move card down: ⌥↓ | Alt+↓ | Move focused card one position down
- Duplicate card: ⌘D | Ctrl+D | Copy current card (text + media) as new card below
- Split at cursor: ⌘⇧S | Ctrl+Shift+S | Split card into two at cursor position
- Merge with next: ⌘⇧M | Ctrl+Shift+M | Combine current card with the one below
- Next card: Tab | Tab | Move focus to next thread card
- Previous card: Shift+Tab | Shift+Tab | Move focus to previous thread card

## Command Palette Actions (via ⌘K / Ctrl+K)
Enumerated list of all 13 actions with their categories and shortcut hints.

## Notes
- Browser conflicts: Some shortcuts may conflict with browser defaults in certain browsers. The Tauri desktop app has no conflicts.
- Focus mode cascade: Escape closes in order: command palette → from-notes panel → focus mode → modal.
```

**Source of truth:** `SHORTCUT_CATALOG` in `dashboard/src/lib/utils/shortcuts.ts:103-118` and `allActions` in `CommandPalette.svelte:41-55`.

### Step 2: Rewrite `docs/composer-mode.md`

**Path:** `docs/composer-mode.md`

This is the largest deliverable. The current doc (124 lines) describes the pre-Session-02 composer. It must be rewritten to reflect the full shipped UX while preserving the accurate sections (enabling, mode switching, MCP tools).

**Design decisions for the rewrite:**

1. **Preserve existing structure where accurate.** The "Enabling Composer Mode", "What Changes", "MCP Tools", and "Switching Between Modes" sections are still accurate and need no changes.

2. **Add new sections for shipped features.** The doc currently has no mention of thread composer, preview, shortcuts, command palette, focus mode, or auto-save. These need dedicated sections.

3. **Fix endpoint inaccuracies.** Draft endpoints (`/api/drafts/*` → `/api/content/drafts/*`), discovery endpoints, and the non-existent `/api/discovery/feed/stats` must be corrected.

4. **Add superiority differentiators explicitly.** The doc should explain why the new UX is better than alternatives (keyboard-first, power actions, structural control, accessibility).

5. **Link to shortcut cheatsheet.** Rather than duplicating the full shortcut table, include a summary and link.

**New outline for `composer-mode.md`:**

```
# Composer Mode

(Existing intro paragraph — keep)

## Enabling Composer Mode (keep as-is)

## What Changes (keep table as-is)

## Thread Composer (NEW)
- Card-based editor: each tweet is a visual card with textarea, character counter, and media slot
- Side-panel preview: live tweet-card rendering (avatar, handle, text, media grid, thread numbering)
- Two-pane layout: editor left, preview right (stacked on mobile)
- Stable block IDs (UUID): each card has a unique ID that survives reorder
- ThreadBlock data model: {id, text, media_paths, order}
- Validation: min 2 cards, max 280 chars per card, no empty cards, per-card media limits

### Power Actions
- Reorder: drag-and-drop handles + Alt+↑/↓ keyboard
- Duplicate (⌘D): copy card text+media as new card below
- Split (⌘⇧S): split at cursor into two cards
- Merge (⌘⇧M): combine with next card

### Per-Tweet Media
- Each card has its own media slot (file picker + drag-drop)
- Constraints: max 4 images (5MB each) OR 1 GIF (15MB) or 1 video (512MB) per card
- Media follows card on reorder

## Distraction-Free Mode (NEW)
- Toggle: ⌘⇧F or header button
- Full-viewport: hides modal chrome, shows editor + preview only
- All functionality preserved: shortcuts, command palette, AI assist
- Escape exits focus mode before closing modal

## Command Palette (NEW)
- Trigger: ⌘K (Mac) / Ctrl+K (Windows/Linux)
- Fuzzy search over 13 actions organized by category
- Shortcut hints displayed per action
- Categories: Mode, Compose, AI, Thread
- Full list: [link to shortcut-cheatsheet.md]

## Keyboard Shortcuts (NEW)
- 14 registered shortcuts covering compose, thread, mode, and AI operations
- Platform-aware: ⌘ on Mac, Ctrl on Windows/Linux
- Summary table (condensed) + link to full cheatsheet
- Shortcuts active only when compose modal is open

## Auto-Save & Recovery (NEW)
- localStorage debounced at 500ms
- Recovery prompt on next compose open if unsaved content exists
- Options: Recover (restore content) or Discard (clear)
- 7-day TTL
- Cleared on successful submit

## AI Assist (UPDATED)
- Existing section: keep API endpoint table but update
- Add: Inline AI Assist (⌘J) — improves selected text or full tweet
- Add: Generate from Notes — paste rough notes, AI generates tweet or thread
- Add: AI assist available from command palette
- Fix: add /api/assist/mode endpoint (GET — returns current operating mode)

### API Endpoints (CORRECTED)
Fix table to match actual server routes. Add `/api/assist/mode`.

## Drafts (UPDATED)
- Existing workflow section: keep
- Add: Thread drafts use blocks format for structured storage
- Add: Draft editing pre-fills compose modal with content
- Fix endpoint paths: /api/drafts/* → /api/content/drafts/*
- Add: /api/content/drafts/{id}/schedule endpoint

### API Endpoints (CORRECTED)
| Method | Path | Description |
| POST   | /api/content/drafts           | Create a new draft |
| GET    | /api/content/drafts           | List all drafts |
| PATCH  | /api/content/drafts/{id}      | Update a draft |
| DELETE | /api/content/drafts/{id}      | Delete a draft |
| POST   | /api/content/drafts/{id}/publish  | Publish a draft |
| POST   | /api/content/drafts/{id}/schedule | Schedule a draft |

## Discovery Feed (UPDATED)
- Keep existing description
- Fix endpoint paths to match actual routes

### API Endpoints (CORRECTED)
| Method | Path | Description |
| GET    | /api/discovery/feed                           | Get scored tweets |
| POST   | /api/discovery/{tweet_id}/compose-reply       | Compose a reply to a discovered tweet |
| POST   | /api/discovery/{tweet_id}/queue-reply         | Queue a reply for posting |

Remove non-existent /api/discovery/feed/stats and /api/discovery/feed/{tweet_id}/reply.

## Compose Endpoint (NEW)
| Method | Path | Description |
| POST   | /api/content/compose | Submit tweet or thread for posting |

Document the request body format including the new `blocks` field:
- Legacy: `{content_type, content, scheduled_for?, media_paths?}`
- New: `{content_type, content, blocks?, scheduled_for?, media_paths?}`
- When `blocks` present, takes precedence for threads

## MCP Tools (keep as-is)

## Switching Between Modes (keep as-is)

## Accessibility (NEW)
- Full keyboard navigation: all actions accessible without mouse
- Focus trap: Tab cycles within modal, never escapes
- Focus return: closing modal returns focus to trigger element
- ARIA: role="dialog", aria-modal, aria-live on counters/errors
- Contrast: WCAG AA (4.5:1) on all text
- Reduced motion: prefers-reduced-motion disables all animations
- Mobile: 44px touch targets, full-viewport below 640px, 16px textarea font (iOS zoom prevention)

## Troubleshooting (NEW)
- Common compose/media payload errors with solutions
- Thread validation errors explained
- Auto-save recovery edge cases
```

### Step 3: Verify endpoint accuracy

Before writing the final docs, cross-reference every endpoint mentioned in `docs/composer-mode.md` against the actual route registrations in `crates/tuitbot-server/src/lib.rs`.

**Issues identified (from current source reading):**

| Current Doc Path | Actual Route | Status |
|------------------|--------------|--------|
| `POST /api/drafts` | `POST /api/content/drafts` | Wrong prefix |
| `GET /api/drafts` | `GET /api/content/drafts` | Wrong prefix |
| `GET /api/drafts/{id}` | No individual GET route exists | Remove |
| `PUT /api/drafts/{id}` | `PATCH /api/content/drafts/{id}` | Wrong prefix + wrong method |
| `POST /api/drafts/{id}/publish` | `POST /api/content/drafts/{id}/publish` | Wrong prefix |
| `DELETE /api/drafts/{id}` | `DELETE /api/content/drafts/{id}` | Wrong prefix |
| (missing) | `POST /api/content/drafts/{id}/schedule` | Not documented |
| `POST /api/discovery/feed/{tweet_id}/reply` | `POST /api/discovery/{tweet_id}/compose-reply` + `POST /api/discovery/{tweet_id}/queue-reply` | Wrong path; actually two separate endpoints |
| `GET /api/discovery/feed/stats` | Does not exist in server routes | Remove |
| (missing) | `GET /api/assist/mode` | Not documented |
| (missing) | `POST /api/content/compose` | Not documented in composer-mode.md |
| (missing) | `POST /api/media/upload` | Not documented in composer-mode.md |

All corrections will be applied during Step 2.

### Step 4: Create `session-07-doc-updates.md`

**Path:** `docs/roadmap/typefully-composer-ui-parity/session-07-doc-updates.md`

**Content structure:**

```
# Session 07 — Documentation Updates

## Files Modified
- docs/composer-mode.md — sections added, endpoints corrected

## Files Created
- docs/roadmap/typefully-composer-ui-parity/shortcut-cheatsheet.md

## Endpoint Corrections
Table of all path corrections made

## New Sections Added
List of every new section in composer-mode.md

## Superiority Differentiators Documented
- Writing speed: keyboard shortcuts + power actions
- Structural control: 4 power actions vs 1, all keyboard-accessible
- Accessibility: full keyboard composability, ARIA, focus trap, contrast, reduced motion
- Feedback clarity: 3 validation types, explicit auto-save, recovery prompt

## Why This UX is Better Than Typefully
Explicit comparison points documented in composer-mode.md
```

### Step 5: Create `session-07-handoff.md`

**Path:** `docs/roadmap/typefully-composer-ui-parity/session-07-handoff.md`

**Content structure:**

```
# Session 07 Handoff

**Date:** 2026-02-27
**Session:** 07 — Docs & Adoption Readiness
**Status:** Complete
**Next Session:** 08 — Final Validation & Go/No-Go

## What Changed
- New files table
- Modified files table

## Decisions Made
- Table with ID, decision, rationale

## Open Risks
- From Session 06 carry-forward (ComposeModal line count)
- Any doc accuracy risks

## Test Coverage
- No code changes → no test gates

## Exact Inputs for Session 08
- Files to read
- Quality gate commands
- Traceability matrix creation instructions
- Superiority scorecard final measurement instructions
- Go/no-go report template
```

---

## Order of Operations

1. **Create `shortcut-cheatsheet.md`** — Self-contained, no dependencies. Uses `SHORTCUT_CATALOG` and `allActions` as source of truth.

2. **Rewrite `docs/composer-mode.md`** — Depends on cheatsheet (for link). This is the main deliverable. Apply all endpoint corrections, add new sections, preserve accurate existing sections.

3. **Create `session-07-doc-updates.md`** — Summarizes what was changed in steps 1-2.

4. **Create `session-07-handoff.md`** — Final handoff for Session 08.

---

## Key Design Decisions

| ID | Decision | Rationale |
|----|----------|-----------|
| D7-1 | Separate shortcut cheatsheet rather than inline in composer-mode.md | Cheatsheet is a quick reference; composer-mode.md is a workflow guide. Separation keeps both focused. |
| D7-2 | Fix endpoint paths rather than documenting both old and new | There is no API version change — the docs simply had wrong paths. Documenting wrong paths creates confusion. |
| D7-3 | Remove `GET /api/drafts/{id}` endpoint from docs | This route does not exist in the server. Individual drafts are fetched via the list endpoint. |
| D7-4 | Remove `GET /api/discovery/feed/stats` from docs | This route does not exist in the server. No implementation was ever added. |
| D7-5 | Add explicit "Why This Is Better" framing | Superiority bar is mandatory per operator rules. Each new section should call out what Typefully does differently and why our approach is better. |
| D7-6 | Add Troubleshooting section to composer-mode.md | Session instructions explicitly request troubleshooting guidance for compose/media payload errors. |
| D7-7 | Do not modify README.md or dashboard/README.md | README already links to composer-mode.md and has a sufficient Composer Mode overview. Dashboard README is stock SvelteKit. |
| D7-8 | Add compose endpoint documentation | `POST /api/content/compose` is the primary submission endpoint but was not documented in composer-mode.md. It must be documented with the new `blocks` field. |
| D7-9 | Add media upload endpoint documentation | `POST /api/media/upload` powers all media attachment but was not documented in composer-mode.md. |
| D7-10 | Preserve existing accurate sections verbatim | "Enabling Composer Mode", "What Changes", "MCP Tools", and "Switching Between Modes" are accurate and should not be rewritten. |

---

## Risks

| # | Risk | Severity | Mitigation |
|---|------|----------|------------|
| R7-1 | Doc endpoint paths may still miss routes | Low | Cross-reference every endpoint against `crates/tuitbot-server/src/lib.rs` route registrations (already done in this plan) |
| R7-2 | Shortcut key combinations may differ between Tauri and browser | Low | Document that browser may have conflicts; Tauri desktop app is conflict-free |
| R7-3 | New docs may reference features that have minor UI differences from description | Low | Verify feature descriptions against actual component source (`ComposeModal.svelte`, `ThreadComposer.svelte`, `CommandPalette.svelte`, `shortcuts.ts`) |
| R7-4 | Compose endpoint `blocks` field behavior description may be imprecise | Low | Verified from `ComposeModal.svelte:250-271` — when `blocks` present, content is also set to JSON stringified text array for backwards compat |

---

## Verification Steps

Since this session only creates/modifies documentation files (`.md`), no CI quality gates apply. However:

1. **Endpoint accuracy:** Every API endpoint mentioned in the updated `composer-mode.md` must match a route in `crates/tuitbot-server/src/lib.rs`. Verification method: grep each path from the doc against the source.

2. **Shortcut accuracy:** Every shortcut in `shortcut-cheatsheet.md` must match an entry in `SHORTCUT_CATALOG` (`dashboard/src/lib/utils/shortcuts.ts:103-118`).

3. **Command palette accuracy:** Every palette action in the cheatsheet must match an entry in `allActions` (`CommandPalette.svelte:41-55`).

4. **Link integrity:** The link from `composer-mode.md` to `shortcut-cheatsheet.md` must use a correct relative path.

5. **No code changes gate:** Confirm no `.rs`, `.svelte`, `.ts`, or `.css` files were modified. Only `.md` files should appear in `git diff`.

6. **Superiority framing:** Verify that at least 3 of the 4 superiority dimensions (writing speed, structural control, feedback clarity, accessibility) are explicitly called out as wins in the updated docs.

---

## Troubleshooting Section Content Plan

The troubleshooting section in `composer-mode.md` should cover:

### Common Compose Errors

| Error | Cause | Solution |
|-------|-------|----------|
| "Maximum 4 images allowed per tweet" | Attaching 5th image | Remove an image before adding another |
| "GIF/video cannot be combined with other media" | Attaching image after GIF/video | X API limitation: GIF/video is exclusive |
| "File exceeds maximum size" | Image >5MB, GIF >15MB, or video >512MB | Compress or resize the file |
| "Failed to upload media" | Server unreachable or disk full | Check that tuitbot-server is running; check disk space |
| Thread submission returns 400 | Empty cards, single-card thread, or duplicate block IDs | Remove empty cards; ensure at least 2 cards; each card needs unique content |

### Thread Validation Errors

| Error | Cause | Solution |
|-------|-------|----------|
| Character count exceeds 280 | Tweet card text too long | Use Split (⌘⇧S) to break into two cards |
| Single-card thread | Only one card in thread mode | Add more cards or switch to tweet mode |
| Empty card | Card with no text content | Type content or remove the empty card |

### Auto-Save Recovery Issues

| Issue | Cause | Solution |
|-------|-------|----------|
| No recovery prompt on reopen | Auto-save expired (>7 days) or was cleared | Content beyond TTL is permanently lost |
| Recovery restores wrong content | Multiple browser tabs | Auto-save uses single localStorage key; last write wins |
| "Recover" button does nothing | localStorage quota exceeded or corrupted | Clear browser storage for the site |

### Media in Threads

| Issue | Cause | Solution |
|-------|-------|----------|
| Media disappears after reorder | Bug (should not happen — media follows card) | Report as bug; media is stored in ThreadBlock.media_paths |
| Cannot attach media to thread card | Media slot hidden or at limit | Check per-card media limit (4 images or 1 GIF/video) |

---

## Migration Notes Content Plan

For users moving from the old compose behavior (pre-Session-02), the doc should include a brief "What Changed" subsection:

1. **Thread editing is now card-based.** Each tweet in a thread is a visual card with its own textarea, character counter, and media slot. The old sequential textarea array is replaced.

2. **Thread data uses structured blocks.** Threads are now stored as `{version, blocks: [{id, text, media_paths, order}]}` JSON. The server still accepts the legacy `content` string format for backwards compatibility.

3. **Media can be attached per-tweet in threads.** Previously, media was only available in tweet mode. Now each thread card has its own media slot.

4. **Keyboard shortcuts are available.** 14 shortcuts cover all compose operations. See the shortcut cheatsheet for the full list.

5. **Auto-save protects your work.** Content is saved to localStorage every 500ms. If you close the modal without submitting, a recovery prompt appears next time.

6. **Command palette for power users.** Press ⌘K to search and execute any compose action without touching the mouse.

7. **API consumers:** If you call the compose or draft endpoints directly, the `blocks` field is optional. Existing integrations using the `content` string field continue to work unchanged.

---

## Session 08 Preview

Session 08 (Final Validation & Go/No-Go) will need:

1. **Traceability matrix** — Map each gap (G-01 through G-11) to implementation evidence (component, line numbers, test coverage).

2. **Superiority scorecard final** — Measure all 16 metrics from `superiority-scorecard.md` with actual values.

3. **Go/no-go report** — Executive summary with verdict, known limitations, and recommended follow-up work.

Session 08 inputs from this session:
- Updated `docs/composer-mode.md` (verified accurate)
- `shortcut-cheatsheet.md` (complete reference)
- All session handoffs (01-07) for traceability
- Source files listed in session-06-handoff for verification
