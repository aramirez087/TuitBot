# Session 1 Implementation Plan: Charter and UI Gap Audit

## Mission

Produce five deliverable documents under `docs/roadmap/typefully-composer-ui-parity/` that constitute the complete UI-first charter for shipping a composer measurably better than Typefully. No source code is modified in this session — all output is documentation.

---

## Current State Assessment

### What Exists Today

**ComposeModal.svelte** (787 lines) — A modal overlay (520px fixed width) with:
- Two modes: tweet and thread, selected via tab buttons
- Tweet mode: single `<textarea>` with weighted character counter
- Thread mode: array of `<textarea>` elements with add/remove, per-part character counters
- Media upload via file picker (images, GIF, video) with preview thumbnails
- TimePicker component for scheduling with preferred time slots
- AI Assist button: generates new tweet or improves existing text via `/api/assist/*`
- Escape to close, backdrop click to close
- No keyboard shortcuts beyond Escape
- No auto-save, no draft persistence on close
- No preview mode, no drag-and-drop, no reorder

**Content Calendar page** (`content/+page.svelte`, 407 lines) — Hosts the ComposeModal, provides week/month calendar views, compose button in header.

**Drafts page** (`drafts/+page.svelte`, 530 lines) — Separate draft management with inline edit, AI improve, schedule, publish, and delete actions. No connection to ComposeModal.

**Backend compose endpoint** (`compose.rs`, 260 lines) — Validates tweet/thread content types, enforces character limits via `tweet_weighted_len`, routes through approval queue or scheduled content based on `approval_mode`.

**API client** (`api.ts`, 945 lines) — Complete typed API client covering compose, drafts, assist, media, content, calendar, and scheduling endpoints.

### What Typefully Offers (Gap Summary)

| Dimension | Typefully | Tuitbot Current |
|-----------|-----------|-----------------|
| Editor paradigm | Inline document editor, `---` separator creates new tweets | Discrete `<textarea>` array in a modal |
| Thread reordering | Drag-and-drop tweet cards | Not supported |
| Media handling | Per-tweet media, drag-drop upload, inline preview, reorder between tweets | File picker only, tweet mode only, no per-tweet in threads |
| Preview | High-fidelity WYSIWYG showing profile pic, handle, timestamps | Raw textarea with character count |
| Scheduling | Calendar drag-drop, next-free-slot, suggested times, queue view | Basic TimePicker with preferred slots |
| Keyboard shortcuts | Cmd+K palette, Cmd+J AI, Cmd+Enter submit, extensive coverage | Escape only |
| Focus mode | Full-screen distraction-free writing | 520px modal overlay |
| AI depth | Inline selection-based AI, hook detection, voice learning, custom prompts | Single button: generate or improve |
| Auto-save | Continuous auto-save | Content lost on modal close |
| Draft management | Tags, search, sharing, locking | Basic list with edit/delete |
| Accessibility | AI alt text, standard patterns | Suppressed a11y warnings |
| Cross-posting | X, LinkedIn, Threads, Bluesky, Mastodon | X only |

---

## Deliverables (5 files)

### File 1: `docs/roadmap/typefully-composer-ui-parity/charter.md`

**Purpose**: Project charter with scope, goals, non-goals, architecture decisions, and success criteria.

**Key sections to write**:

1. **Executive Summary** — One paragraph: ship a composer UX that beats Typefully in writing speed, structural control, feedback clarity, and accessibility.

2. **Scope** — UI parity initiative only. Covers ComposeModal, ThreadComposer (new), content/drafts page integration, backend contract updates for thread ordering and per-tweet media.

3. **Non-Goals** (explicitly documented):
   - Ghostwriter engine (voice learning, hook detection, custom AI prompts)
   - Filesystem ingestion / RAG pipeline
   - Background seed systems
   - Cross-posting to non-X platforms
   - Collaborative editing / draft sharing / draft locking
   - Native Mac app or Raycast extension
   - Polls, photo tags, community posts
   - Watchtower monitoring

4. **Architecture Decisions**:
   - **Decision A-1**: Extract thread editing from ComposeModal into a dedicated `ThreadComposer.svelte` component. Rationale: ComposeModal is already 787 lines; thread-specific logic (reorder, per-tweet media, preview) would push it past the 400-line Svelte limit. ThreadComposer owns thread state; ComposeModal orchestrates tweet/thread mode switching and submit.
   - **Decision A-2**: Introduce stable block IDs for thread parts. Each tweet block gets a UUID. Backend validates ordering by accepting `blocks: [{id, text, media_paths, order}]` in the compose/draft payloads. This enables optimistic reorder without re-indexing.
   - **Decision A-3**: Thread data stored as structured JSON (array of block objects) rather than `\n---\n`-joined strings. Backend `compose.rs` and `drafts.rs` must accept both legacy `content` (string) and new `blocks` field for backwards compatibility.
   - **Decision A-4**: Live preview panel uses a new `TweetPreview.svelte` component that renders tweet cards with avatar placeholder, handle, text, media grid, and timestamp — purely presentational, no backend calls.
   - **Decision A-5**: Command palette implemented as a new `CommandPalette.svelte` component with Cmd+K (Mac) / Ctrl+K (Win) trigger. Actions registered declaratively; no global store pollution.
   - **Decision A-6**: Distraction-free mode is a full-viewport state of ComposeModal (not a separate route). Toggle via Cmd+Shift+F or button. Hides sidebar, header, and modal chrome; shows only the editor and preview.
   - **Decision A-7**: Auto-save drafts to localStorage on every keystroke (debounced 500ms). Recovery prompt on next compose open if unsaved content exists. No backend change needed.

5. **Superiority Targets** (4 dimensions, each with measurable criteria):
   - Writing Speed: Time-to-compose a 5-tweet thread < 3 minutes (vs. Typefully's ~3-4 min based on UX reviews)
   - Structural Control: Reorder, duplicate, split, merge — all available via keyboard
   - Feedback Clarity: Live character count + WYSIWYG preview + inline validation errors
   - Accessibility: Full keyboard navigation, ARIA labels, focus management, 4.5:1 contrast ratio

6. **API Compatibility** — Existing `POST /api/content/compose` with `{content_type, content, scheduled_for, media_paths}` must continue working. New fields are additive.

### File 2: `docs/roadmap/typefully-composer-ui-parity/ui-gap-audit.md`

**Purpose**: Detailed feature-by-feature comparison between Typefully and current Tuitbot, categorized by priority.

**Structure**:

1. **Critical Gaps (Must Fix for Parity)**:
   - Thread editor paradigm (inline vs textarea array)
   - Thread reordering (drag-and-drop + keyboard)
   - Per-tweet media in threads
   - Live WYSIWYG preview
   - Keyboard shortcuts beyond Escape
   - Auto-save / recovery

2. **Important Gaps (Needed for Superiority)**:
   - Command palette (Cmd+K)
   - Distraction-free / focus mode
   - Inline AI assist on selection (Cmd+J)
   - Media drag-and-drop upload
   - Power actions: duplicate, split, merge thread cards

3. **Nice-to-Have (Post-Initiative)**:
   - Emoji picker
   - AI alt text for images
   - Auto thread splitting from long text
   - Auto tweet numbering
   - Calendar drag-drop rescheduling
   - Draft tags and search

4. **Explicitly Out of Scope**:
   - Cross-posting (LinkedIn, Threads, Bluesky, Mastodon)
   - Voice memo to draft
   - AI voice learning / Ghostwriter engine
   - Collaborative draft editing, sharing, locking
   - Native app / Raycast extension
   - Polls / photo tags / community posts

Each gap entry includes: feature name, Typefully behavior, Tuitbot current behavior, target behavior, session assignment, and priority rating.

### File 3: `docs/roadmap/typefully-composer-ui-parity/superiority-scorecard.md`

**Purpose**: Measurable criteria that prove "better than Typefully" in at least 3 dimensions.

**Scorecard dimensions**:

| Dimension | Metric | Typefully Baseline | Tuitbot Target | Measurement Method |
|-----------|--------|-------------------|----------------|-------------------|
| Writing Speed | Time to compose 5-tweet thread | ~3-4 min (manual testing) | <3 min | Manual timed test |
| Writing Speed | Keystrokes to reorder 5-tweet thread | ~15 (drag ops) | ≤8 (Alt+↑/↓ keyboard) | Keystroke count |
| Structural Control | Power actions available | Reorder only | Reorder + Duplicate + Split + Merge | Feature checklist |
| Structural Control | Keyboard shortcut coverage | ~12 shortcuts | ≥15 shortcuts | Shortcut count |
| Feedback Clarity | Preview fidelity | WYSIWYG inline | WYSIWYG side panel | Visual comparison |
| Feedback Clarity | Inline validation errors | Character only | Character + media + structure | Error type count |
| Accessibility | Keyboard-only composability | Partial | Full (all actions keyboard-accessible) | Manual keyboard-only test |
| Accessibility | ARIA landmark coverage | Standard | Full: roles, labels, live regions | Axe audit |
| Accessibility | Focus management | Standard | Trapped in modal, focus return, skip links | Manual test |
| Accessibility | Color contrast | Unknown | 4.5:1 minimum (WCAG AA) | Contrast checker |

**Win criteria**: Score ≥ Typefully in all 4 dimensions, with clear superiority in at least 3.

### File 4: `docs/roadmap/typefully-composer-ui-parity/session-execution-map.md`

**Purpose**: Phased session map (Sessions 02-08) with exact file targets, dependencies, and quality gates.

**Session 02: Data Model & API Contract**
- Goal: Typed thread block schema with stable IDs, backwards-compatible compose/draft endpoints
- Files to create/modify:
  - `crates/tuitbot-server/src/routes/content/compose.rs` — Add `blocks` field to `ComposeRequest`, validate block ordering and per-block media
  - `crates/tuitbot-server/src/routes/content/drafts.rs` — Add `blocks` support to `CreateDraftRequest` and `EditDraftRequest`
  - `crates/tuitbot-core/src/storage/scheduled_content.rs` — May need schema awareness for structured thread content
  - `dashboard/src/lib/api.ts` — Add `ThreadBlock` type, update `ComposeRequest` type with optional `blocks` field
  - `crates/tuitbot-server/tests/api_tests.rs` — Add contract tests for new schema
- Quality gates: Full Rust CI checklist + `npm run check`
- Exit criteria: Backend accepts ordered thread payloads with per-item media; legacy flows pass; block IDs survive roundtrip

**Session 03: Thread Composer Foundation UI**
- Goal: Visual tweet-card composer with edit + preview side-by-side
- Files to create/modify:
  - `dashboard/src/lib/components/ThreadComposer.svelte` — NEW: card-based thread editor with per-card textarea, character counter, add/remove
  - `dashboard/src/lib/components/TweetPreview.svelte` — NEW: read-only tweet card render (avatar, handle, text, media grid, timestamp)
  - `dashboard/src/lib/components/ComposeModal.svelte` — Refactor to delegate thread mode to ThreadComposer, keep tweet mode inline
  - `dashboard/src/routes/(app)/content/+page.svelte` — Wire updated ComposeModal
  - `dashboard/src/routes/(app)/drafts/+page.svelte` — Wire updated ComposeModal for draft editing
- Quality gates: `npm run check`
- Exit criteria: Users compose in cards with live preview; validation prevents invalid submits

**Session 04: Reorder & Media Placement**
- Goal: Drag-and-drop + keyboard reorder, per-tweet media, power actions
- Files to create/modify:
  - `dashboard/src/lib/components/ThreadComposer.svelte` — Add reorder (up/down buttons + keyboard Alt+↑/↓), drag handle, duplicate/split/merge
  - `dashboard/src/lib/components/ComposeModal.svelte` — Wire media upload to per-tweet assignment
  - `dashboard/src/lib/components/MediaSlot.svelte` — NEW: per-tweet media attachment zone with drag-drop
- Quality gates: `npm run check`, optional Rust gates if media validation changes
- Exit criteria: Reorder persists through submit; power actions work; media moves between cards

**Session 05: Distraction-Free Writing Mode**
- Goal: Full-viewport compose, command palette, enhanced AI assist
- Files to create/modify:
  - `dashboard/src/lib/components/ComposeModal.svelte` — Add fullscreen/focus mode toggle, Cmd+Shift+F
  - `dashboard/src/lib/components/CommandPalette.svelte` — NEW: Cmd+K action palette with search, categories
  - `dashboard/src/lib/components/ThreadComposer.svelte` — Integrate command palette actions, inline AI selection
  - `dashboard/src/lib/utils/shortcuts.ts` — NEW: keyboard shortcut registry and handler
- Quality gates: `npm run check`
- Exit criteria: Focus mode works with no functionality loss; command palette covers core actions; shortcuts documented

**Session 06: Responsive & Accessible Polish**
- Goal: Mobile layouts, keyboard-only flows, contrast compliance, animation
- Files to create/modify:
  - `dashboard/src/lib/components/ComposeModal.svelte` — Mobile breakpoints, focus trap, ARIA
  - `dashboard/src/lib/components/ThreadComposer.svelte` — Mobile card layout, touch targets
  - `dashboard/src/lib/components/TweetPreview.svelte` — Responsive preview
  - `dashboard/src/app.css` — Focus indicator tokens, reduced motion media query
- Quality gates: `npm run check`
- Exit criteria: Mobile-stable; keyboard-only compose works; WCAG AA contrast; no known regressions

**Session 07: Docs & Adoption Readiness**
- Goal: Documentation reflects shipped UX, migration notes, shortcut cheatsheet
- Files to create/modify:
  - `docs/composer-mode.md` — Update with thread composer workflow, preview, shortcuts
  - `docs/roadmap/typefully-composer-ui-parity/shortcut-cheatsheet.md` — NEW: keyboard shortcut reference
- Quality gates: All gates if any code touched
- Exit criteria: Docs accurate; superiority differentiators documented

**Session 08: Final Validation & Go/No-Go**
- Goal: End-to-end validation, scorecard evaluation, go/no-go verdict
- Files to create/modify:
  - `docs/roadmap/typefully-composer-ui-parity/traceability-matrix.md` — NEW
  - `docs/roadmap/typefully-composer-ui-parity/superiority-scorecard-final.md` — NEW
  - `docs/roadmap/typefully-composer-ui-parity/final-go-no-go-report.md` — NEW
- Quality gates: Full Rust CI + `npm run check`
- Exit criteria: All requirements pass/fail with evidence; scorecard shows wins; verdict issued

### File 5: `docs/roadmap/typefully-composer-ui-parity/session-01-handoff.md`

**Purpose**: Session handoff with changes made, decisions locked, open risks, and exact inputs for Session 02.

**Content**:

1. **What Changed**: Five charter documents created (charter, gap audit, scorecard, execution map, handoff). No code modified.

2. **Decisions Made**:
   - ThreadComposer.svelte as separate component (A-1)
   - Stable block IDs with UUID (A-2)
   - Structured JSON for thread data (A-3)
   - TweetPreview.svelte for WYSIWYG (A-4)
   - CommandPalette.svelte with Cmd+K (A-5)
   - Full-viewport focus mode via modal state (A-6)
   - localStorage auto-save with debounce (A-7)

3. **Risk Register**:

   | Risk | Impact | Likelihood | Mitigation |
   |------|--------|-----------|------------|
   | Thread block schema breaks existing drafts | High | Medium | Backwards-compatible: accept both `content` string and `blocks` array. Migration script for existing drafts. |
   | Drag-and-drop reorder conflicts with textarea focus | Medium | Medium | Use dedicated drag handle zones, not full-card drag. Keyboard reorder as primary path. |
   | WYSIWYG preview diverges from actual X rendering | Medium | High | Use conservative styling; do not try to pixel-match X. Focus on structural accuracy (text length, media grid). |
   | Mobile compose UX in 520px modal | High | Low | Session 06 adds responsive breakpoints. For mobile, compose expands to full viewport. |
   | localStorage auto-save data growth | Low | Low | Clear on successful submit. Cap at 10 drafts. TTL of 7 days. |
   | a11y violations in suppress-ignore blocks | Medium | High | Session 06 removes all `svelte-ignore a11y_*` directives. Replace with proper ARIA attributes. |
   | Payload size increase with per-block media arrays | Low | Low | Backend already handles media_paths arrays. Per-block adds negligible overhead. |

4. **Exact Inputs for Session 02**:
   - Read: `docs/roadmap/typefully-composer-ui-parity/charter.md` (architecture decisions A-2, A-3)
   - Read: `docs/roadmap/typefully-composer-ui-parity/session-01-handoff.md` (this file)
   - Modify: `crates/tuitbot-server/src/routes/content/compose.rs`
   - Modify: `crates/tuitbot-server/src/routes/content/drafts.rs`
   - Modify: `crates/tuitbot-core/src/storage/scheduled_content.rs`
   - Modify: `dashboard/src/lib/api.ts`
   - Create: `crates/tuitbot-server/tests/` (contract tests)
   - Run: `cargo fmt --all && cargo fmt --all --check`
   - Run: `RUSTFLAGS="-D warnings" cargo test --workspace`
   - Run: `cargo clippy --workspace -- -D warnings`
   - Run: `cd dashboard && npm run check`

---

## Order of Operations

Since this is a documentation-only session, the operations are straightforward:

1. **Create directory**: `docs/roadmap/typefully-composer-ui-parity/` (already exists but empty)

2. **Write `charter.md`**: Comprehensive project charter with all architecture decisions, scope, non-goals, and success criteria. This is the anchor document — all other deliverables reference it.

3. **Write `ui-gap-audit.md`**: Feature-by-feature gap analysis comparing Typefully vs. Tuitbot current state. Categorized by priority with session assignments.

4. **Write `superiority-scorecard.md`**: Measurable criteria table with Typefully baseline, Tuitbot target, and measurement methods for 4 dimensions.

5. **Write `session-execution-map.md`**: Detailed session-by-session plan (Sessions 02-08) with file targets, dependencies, quality gates, and exit criteria.

6. **Write `session-01-handoff.md`**: Handoff document with decisions, risks, and exact Session 02 inputs.

---

## Key Design Decisions and Rationale

### D-1: ThreadComposer as Separate Component
**Rationale**: ComposeModal.svelte is 787 lines. Thread editing (card management, reorder, per-tweet media, preview) would add 500+ lines. Splitting follows the 400-line Svelte file limit in CLAUDE.md. ThreadComposer owns all thread-specific state; ComposeModal passes callbacks and orchestrates mode switching.

### D-2: Stable Block IDs (UUIDs)
**Rationale**: Without stable IDs, reordering requires array index tracking which breaks on concurrent edits and makes optimistic UI updates fragile. UUIDs generated client-side enable: (a) reorder by updating `order` field, (b) per-block media references survive reorder, (c) future collaborative editing support.

### D-3: Structured JSON Over Delimiter-Joined Strings
**Rationale**: Current thread storage uses `\n---\n` joined strings (compose.rs line 104). This loses metadata (media per block, ordering). Structured `blocks` JSON preserves all per-tweet data. Backwards-compatible: server accepts both formats.

### D-4: Side-Panel Preview vs. Inline WYSIWYG
**Rationale**: Typefully uses inline WYSIWYG. A side panel is simpler to implement, avoids contenteditable complexity, keeps editing in textarea (reliable input handling), and provides a clear visual separation between authoring and preview. This is a deliberate differentiation — not inferior, just different.

### D-5: Keyboard-First Philosophy
**Rationale**: Typefully has Cmd+K but many actions still require pointer. Our superiority claim is "all thread operations keyboard-accessible." This means: Cmd+K palette, Alt+↑/↓ reorder, Cmd+Enter submit, Cmd+J AI assist, Cmd+D duplicate, Cmd+Shift+S split, Tab/Shift+Tab between cards.

### D-6: localStorage Auto-Save, Not Backend Auto-Save
**Rationale**: Backend auto-save requires new API endpoints and creates state management complexity (what status? how to recover? conflicts with explicit drafts?). localStorage is zero-backend-cost, instant, and recoverable. Clear on successful submit or after 7-day TTL.

### D-7: No Ghostwriter / AI Voice Learning in Scope
**Rationale**: Operator rules explicitly exclude this. Our AI assist calls existing `/api/assist/*` endpoints only. Inline AI (select text → improve) is new UI behavior over existing backend capability, not a new AI engine.

---

## Risks and Mitigations

| # | Risk | Severity | Mitigation |
|---|------|----------|------------|
| R-1 | Thread block schema migration breaks existing drafts | High | Accept both `content` (legacy) and `blocks` (new) in API. Server normalizes internally. No DB migration required — content column stores JSON string. |
| R-2 | Drag-and-drop library adds significant bundle size | Medium | Use HTML5 native drag-and-drop API. No library. Keyboard reorder as primary path means drag-drop is enhancement, not requirement. |
| R-3 | WYSIWYG preview doesn't match actual X rendering | Medium | Don't try to pixel-match. Use simplified tweet card rendering. Document that preview is approximate. Focus on text length, media grid layout, not fonts/colors. |
| R-4 | ComposeModal refactor introduces regressions in tweet mode | High | Session 03 must preserve all existing tweet compose behavior. Test: open modal, type tweet, attach media, schedule, submit. All must work identically. |
| R-5 | Mobile compose UX degraded by modal approach | Medium | Session 06 makes modal full-viewport on mobile (< 768px). Touch targets ≥ 44px. Media upload via native file picker (already works). |
| R-6 | Accessibility work in Session 06 may reveal fundamental component issues | Medium | Start with semantic HTML in Sessions 03-05. Use `<button>` not `<div onclick>`, `<label>` not bare text, `role="dialog"` on modal. Session 06 polishes, doesn't rebuild. |
| R-7 | Command palette conflicts with browser shortcuts | Low | Use Cmd+K which is unused in most browsers (Chrome search bar can be overridden in Tauri). Register at window level with `preventDefault()`. |
| R-8 | Per-tweet media upload UX is confusing with thread reordering | Medium | Media slot is visually attached to each tweet card. Reordering a card moves its media. Explicit "move media to card N" action in context menu / command palette. |

---

## Verification Steps

Since this session produces only documentation:

1. **Verify all 5 files exist** at the correct paths under `docs/roadmap/typefully-composer-ui-parity/`
2. **Verify charter has no unresolved decisions** — grep for "TBD", "TODO", "DECISION NEEDED"
3. **Verify scorecard defines measurable criteria** — each dimension has baseline, target, and measurement method
4. **Verify non-goals explicitly exclude** Ghostwriter engine, watchtower, RAG, background seed systems
5. **Verify handoff includes exact inputs for Session 02** — file paths and commands listed
6. **Verify session execution map covers Sessions 02-08** with file targets for each
7. **No code modified** — `git diff` should show only new files in `docs/roadmap/`

No Rust or dashboard CI gates apply since no source code changes.

---

## File Paths Summary

Files to create (all new):
- `/Users/aramirez/Code/ReplyGuy/docs/roadmap/typefully-composer-ui-parity/charter.md`
- `/Users/aramirez/Code/ReplyGuy/docs/roadmap/typefully-composer-ui-parity/ui-gap-audit.md`
- `/Users/aramirez/Code/ReplyGuy/docs/roadmap/typefully-composer-ui-parity/superiority-scorecard.md`
- `/Users/aramirez/Code/ReplyGuy/docs/roadmap/typefully-composer-ui-parity/session-execution-map.md`
- `/Users/aramirez/Code/ReplyGuy/docs/roadmap/typefully-composer-ui-parity/session-01-handoff.md`

Files to read (already read during planning):
- `dashboard/src/lib/components/ComposeModal.svelte`
- `dashboard/src/routes/(app)/content/+page.svelte`
- `dashboard/src/routes/(app)/drafts/+page.svelte`
- `dashboard/src/lib/api.ts`
- `crates/tuitbot-server/src/routes/content/compose.rs`
- `crates/tuitbot-server/src/routes/content/drafts.rs`
- `crates/tuitbot-server/src/routes/content/mod.rs`
- `dashboard/src/lib/stores/calendar.ts`
- `dashboard/src/lib/utils/tweetLength.ts`
- `dashboard/src/lib/components/TimePicker.svelte`
- `dashboard/src/app.css`
- `docs/composer-mode.md`
- All session definition files under `docs/claude-sessions/typefully-composer-ui-parity/`

Files NOT modified:
- All source code files remain untouched
- No Rust, TypeScript, Svelte, or CSS modifications
